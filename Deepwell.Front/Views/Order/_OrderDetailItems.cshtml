@model IEnumerable<Deepwell.Front.Models.Order.OrderDetailItemViewModel>
@using Deepwell.Common.Extensions

@if (Model.IsNotNull())
{
    <div class="row">
        <div class="table_panel">
            <table>
                <thead>
                    <tr>
                        @*<td><input type="checkbox" /></td>*@
                        <td>Action</td>
                        <td>Line Number</td>
                        <td>Product Name</td>
                        <td>Location</td>
                        <td>Price(USD)</td>
                        <td>Quantity</td>
                        <td>UOM</td>
                        <td>Item Total</td>
                        <td>Inventory</td>
                        <td>Taxable</td>
                        <td>Line Status</td>
                    </tr>
                </thead>

                <tbody>
                    @{
                        int index = 1;
                        foreach (var item in Model)
                        {
                            var quantityBoxDisabled = item.IsQuantityEditable ? "" : "disabled='disabled'";

                            <tr id="tr@(index)"
                                data-locationid="@item.LocationId"
                                data-productid="@item.ProductId"
                                data-price="@item.SellPrice"
                                data-orderdetailid="@item.OrderDetailId"
                                data-currentstatus="@item.Status">

                                <td style="min-width: 100px">
                                    <div class="processing" style="display:none;">
                                        Updating...
                                    </div>
                                    @if (item.IsDisplayRemoveButton)
                                    {
                                        <a id="aOrderItemDelete@(index)" data-itemaction="remove" class="action_btn del n_d orderItemRemove" title="Remove"></a>
                                    }

                                    @if (item.IsDisplayShipButton)
                                    {
                                        <a id="aOrderItemShipPopupOpener@(index)" data-index="@index" class="action_btn ship n_d shipQuantityPopupOpener" title="Ship"></a>

                                        <div id="dvOrderItemsShipPopUp@(index)" class="orderItemsShipPopUp" title="Ship Items" style="display:none;">
                                            <input id="txtShipQuantity@(index)" value="@item.Quantity" type="number" class="shipQuantity"
                                                   min="1" max="@item.QuantityAvailable" data-maxquantity=@item.Quantity data-quantityavailable="@item.QuantityAvailable" /> out of @item.Quantity
                                                <div class="clr"></div>
                                                <div class="message" style="display:none;color:red;"></div>
                                                <a id="aOrderItemShip@(index)" data-item="ship" data-trid="tr@(index)" title="Ship" style="cursor:pointer">Ship</a><br />
                                            </div>

                                        }

                                    @if (item.IsDisplayReturnButton)
                                    {
                                        @*<a id="aOrderItemReturn@(index)" data-itemaction="return" style="color:blue;cursor:pointer" class="">Return</a>*@

                                        <a id="aReturnQuantityPopupOpener@(index)" data-index="@index" style="color:blue;cursor:pointer" class="returnQuantityPopupOpener action_btn n_d no_circle return" title="Return"></a>

                                        <div id="dvOrderItemsReturnPopUp@(index)" class="orderItemsReturnPopUp" style="display:none;" title="Return Items">
                                            <input id="txtReturnQuantity@(index)" value="@item.MaxReturnableQuantity" type="number" class="returnQuantity"
                                                   min="1" max="@item.MaxReturnableQuantity" data-maxquantity=@item.MaxReturnableQuantity />  out of @item.MaxReturnableQuantity
                                                <div class="clr" style="height: 15px;"></div>
                                                Enter tax %: <input id="txtReturnTax" class="limitQuantity" maxlength="6"/>
                                                <div class="clr"></div>
                                                <div class="message" style="display:none;color:red;"></div>
                                                <a id="aOrderItemReturn@(index)" data-item="return" data-trid="tr@(index)" class="return" style="cursor:pointer">Return</a>
                                            </div>
                                        }

                                    @if (item.IsDisplayCancelButton)
                                    {
                                        <a id="aOrderItemCancel@(index)" data-itemaction="cancel" class="action_btn n_d no_circle cancel" title="Cancel"></a>
                                    }
                                </td>
                                <td>@item.LineNumber</td>
                                <td>@item.ProductName</td>
                                <td>@item.LocationLabel</td>
                                <td>
                                    @item.PriceToDisplay
                                    @if (item.IsDisplayTierPriceSymbol)
                                    {
                                        <img src="~/Content/images/star.jpg" style="width:30px;">
                                    }
                                </td>
                                <td>
                                    <div class="ctrl_group">
                                        <input id="txtOrderItemQuantity@(index)" value="@item.Quantity" class="orderItemQuantity"
                                               data-originalquantity=@item.Quantity
                                               type="number" min="1" data-quantityavailable="@item.QuantityAvailable"
                                               @quantityBoxDisabled />
                                    </div>
                                </td>
                                <td>@item.UnitOfMeasure</td>
                                <td>
                                    @item.ItemTotal
                                </td>
                                <td>
                                    @if (item.IsDisplayQuantityAvailable)
                                    {
                                        <span class="spnQuantityAvailable">@item.QuantityAvailable</span>
                                    }
                                </td>
                                <td>@item.IsTaxable</td>
                                @if (item.InvoiceId > 0)
                                {
                                    var invoiceLabel = item.Status.ToString() + "(" + item.InvoiceId + ")";
                                    <td><a href="@Url.Action("GetInvoicedItems", "Order", new { invoiceId = item.InvoiceId })" target="_blank">@invoiceLabel</a></td>
                                }
                                else if (item.CreditMemoId > 0)
                                {
                                    var returnLabel = item.Status.ToString() + "(" + item.CreditMemoId + ")";
                                    <td><a href="@Url.Action("GetReturnedItems", "Order", new { creditMemoId = item.CreditMemoId })" target="_blank">@returnLabel</a></td>
                                }
                                else
                                {
                                    <td>@item.Status.ToString()</td>
                                }
                            </tr>
                            <tr style="display:none;">
                                <td colspan="10" align="center">
                                    <div id="dvMessage(@index)" style="display:none;color:red"></div>
                                </td>
                            </tr>
                            index++;
                        }
                    }
                </tbody>
            </table>
        </div>
    </div><!--/.row-->
}
